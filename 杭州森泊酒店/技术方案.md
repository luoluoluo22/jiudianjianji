# 酒店旅拍自动化剪辑技术方案

本方案旨在通过 AI 与自动化脚本结合，解决酒店旅拍视频剪辑中“机械性替换、素材质量不一、人工成本高”的问题。

## 1. 核心架构：三层自动化体系

### 10. AI 视觉理解层 (Brain)
- **引擎**：利用 `antigravity-api-skill` 集成的 **Gemini 3 Pro** 视频分析能力。
- **任务**：
    - **多模态筛选**：自动识别素材中的特定动作（如：奔跑、转圈、挥手、微笑）。
    - **构图合规性检查**：检测并剔除“人头出画”、“起步停顿”等坏片。
    - **高光提取**：从一段长素材中自动定位最优的 2-3 秒高光点。
- **交付建议**：配置专门的 `video_analyzer.py` 或 `prompt`，针对“高光动作”进行分镜拆解。

### 11. 脚本逻辑驱动层 (Worker)
- **引擎**：基于 `pyJianYingDraft` 与 `JyWrapper` 的 Python 环境。
- **核心逻辑 (`batch_process.py`)**：
    - **动态调速适配**：当原始素材时长不足以填补模板坑位时，程序自动计算并修改 `materials.speeds`，确保无静止帧。
    - **路径注入**：直接在 `draft_content.json` 中修改 `path` 属性，实现秒级替换。
    - **命名自动化**：正则匹配文件夹中的客户姓名，自动批量生成命名规范的项目草稿。

### 12. 媒体加工与合成层 (Engine)
- **引擎**：**剪映 Pro (JianYing Pro) v5.9** 环境。
- **自动化参数**：
    - **变速**：全局统一 0.5x 慢放处理。
    - **调色**：注入预设的曝光及白平衡修正参数。
    - **导出**：利用 `auto_exporter.py` 进行分阶段静默导出。

---

## 2. 关键业务逻辑流程 (Workflow)

1.  **素材扫描**：脚本递归扫描 `assets/` 目录，按日期和客户名匹配文件夹。
2.  **AI 预处理 (可选增强模式)**：
    *   调用 Gemini 分析素材分镜。
    *   匹配需求（动作：奔跑、微笑 -> 是；人头完整 -> 是）。
    *   反馈分镜时间轴（Start/End）。
3.  **草稿克隆与注入**：
    *   以 `20S 模板` 为基准。
    *   更新 Material 库路径。
    *   根据素材实际时长，自动修正 `source_timerange` 并对齐 `target_timerange`。
4.  **异常记录**：
    *   素材总长 < 20s -> 写入 `missing_assets.log`。
    *   AI 未能发现有效人物镜头 -> 写入 `quality_retry.log`。
5.  **批量导出**：后台启动剪映，自动调用导出模块生成最终的客户命名视频。

---

## 3. 技术路线优势
- **速度极快**：基于草稿 JSON 的注入，替换 100 个视频仅需数秒，无需打开剪辑界面。
- **质量稳定**：通过 AI 注入“质量意识”（不切头、取动作），替代初级剪辑师的审美判断。
- **可复用性**：只需修改 `PROJECT_ROOT` 和 `TEMPLATE_DIR`，即可快速适配新的酒店或视频时长。
